name: 'generate-sbom'
description: 'Generate SBOM for corePKCS11 library'
inputs:
  path:
    description: 'Path to repository folder containing manifest.yml to verify.'
    required: false
    default: ./
runs:
  using: "composite"
  steps:
      - name: Install dependencies
        run: pip install -r $GITHUB_ACTION_PATH/requirements.txt
        shell: bash 
      - name: Run generator script
        working-directory: ${{ inputs.path }}
        run: |
          python3 $GITHUB_ACTION_PATH/scan_corePKCS11.py
        shell: bash
      - name: Update SBOM file and push to repo
        working-directory: ${{ inputs.path }}
        run: |
          git config --global user.name ${{ github.actor }}
          git config --global user.email ${{ github.actor }}@users.noreply.github.com
          git add .
          changed=$(git diff-index HEAD)
          if [ -n "$changed" ]; then
            git commit -m "Update SBOM for corePKCS11"
            git push origin
          fi
        shell: bash
