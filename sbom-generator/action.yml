name: 'generate-sbom'
description: 'Generate SBOM for FreeRTOS libraries'
inputs:
  repo_path:
    description: 'Path to repository folder containing manifest.yml to verify.'
    required: false
    default: ./
  source_path:
    description: 'Path to source code'
    required: false
    default: ./source
  namespace:
    description: 'SPDX document namespace URL'
    required: false
runs:
  using: "composite"
  steps:
    - name: Install dependencies
      shell: bash
      run: pip install -r $GITHUB_ACTION_PATH/requirements.txt

    - name: Run generator script
      working-directory: ${{ inputs.repo_path }}
      shell: bash
      env:
        SBOM_NAMESPACE: ${{ inputs.namespace }}
        PYTHONUNBUFFERED: 1
      run: |
        echo "Running SBOM generator with source path: ${{ inputs.source_path }}"
        python3 -u $GITHUB_ACTION_PATH/scan_dir.py --source-path ${{ inputs.source_path }}
